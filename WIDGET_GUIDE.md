# UniSchedule Widget 使用指南

## 概述
UniSchedule 支持 Android 主屏幕小部件，让您无需打开应用即可查看今日课程。

## 功能特点

- 📱 **今日课程显示**：自动显示当天的所有课程
- 🔄 **自动更新**：每30分钟自动刷新
- 📅 **日期显示**：显示当前日期和星期
- ⏰ **时间信息**：显示课程时间段和节次
- 📍 **详细信息**：显示教室、教师等信息
- 🎨 **美观设计**：圆角白色背景，清晰易读
- 👆 **点击打开**：点击小部件可直接打开应用

## 添加小部件步骤

### 方法 1：长按主屏幕
1. 长按 Android 主屏幕空白处
2. 点击「小部件」或「Widgets」
3. 找到「UniSchedule」
4. 长按拖动到主屏幕
5. 调整大小（如果需要）

### 方法 2：应用列表
1. 打开应用抽屉
2. 找到 UniSchedule 应用
3. 长按应用图标
4. 选择「小部件」
5. 选择「今日课程」小部件
6. 拖动到主屏幕

## 小部件尺寸

### 推荐尺寸
- **最小尺寸**：2x2 单元格（约 180x180 dp）
- **推荐尺寸**：4x3 单元格（约 360x270 dp）
- **最大尺寸**：可调整至任意大小

### 尺寸说明
- **小**（2x2）：显示1-2门课程
- **中**（4x3）：显示3-4门课程
- **大**（4x4及以上）：显示更多课程，滚动查看

## 小部件内容

### 显示信息
```
今日课程
02月02日 星期一

📚 窄带物联网通信技术
⏰ 第1-2节 (08:00-09:40)
📍 勤德楼-B401 | 👨‍🏫 郑亮

📚 信息技术应用创新实践
⏰ 第3-4节 (10:00-11:40)
📍 勤德楼-B501 | 👨‍🏫 刘振涛

更新于 14:30
```

### 无课程时
```
今日课程
02月02日 星期一

今日无课 🎉
享受轻松的一天！

更新于 14:30
```

### 无数据时
```
今日课程
02月02日 星期一

暂无课程数据
请打开应用导入课程

更新于 14:30
```

## 更新机制

### 自动更新
- 小部件每30分钟自动刷新一次
- 系统重启后自动更新
- 日期变化时自动更新

### 手动更新
- 点击小部件会打开应用
- 在应用中导入或修改课程后，小部件会自动同步

### 强制刷新
如果小部件显示不正确：
1. 删除现有小部件
2. 重新添加小部件到主屏幕
3. 或重启设备

## 数据同步

### 存储机制
- 小部件从应用的数据存储中读取课程信息
- 使用 Capacitor Preferences API 存储
- 数据在应用和小部件之间自动同步

### 同步时机
- 导入新课程时立即同步
- 修改课程时立即同步
- 应用启动时验证同步

## 故障排除

### 小部件不显示课程
**问题**：小部件显示"暂无课程数据"

**解决方法**：
1. 打开 UniSchedule 应用
2. 导航到「导入」标签
3. 导入您的课程数据
4. 等待几秒钟，小部件会自动更新

### 小部件显示错误课程
**问题**：显示的课程不是今天的

**解决方法**：
1. 检查设备日期和时间设置
2. 删除并重新添加小部件
3. 或在应用中重新导入课程

### 小部件不更新
**问题**：课程数据已改变但小部件未更新

**解决方法**：
1. 删除小部件并重新添加
2. 检查应用权限设置
3. 重启设备
4. 重新安装应用

### 小部件显示"加载失败"
**问题**：小部件显示加载错误

**解决方法**：
1. 确保应用已正确安装
2. 清除应用数据并重新导入
3. 检查存储权限
4. 重新安装 APK

## 技术细节

### 更新频率
- **自动更新间隔**：30分钟（1800000毫秒）
- **最小更新间隔**：由 Android 系统控制（通常不少于30分钟）
- **系统限制**：为节省电量，实际更新可能延迟

### 存储位置
- **数据存储**：CapacitorStorage（SharedPreferences）
- **键名**：unischedule_courses
- **格式**：JSON 数组

### 权限需求
- **无需额外权限**：小部件只读取应用自己的数据
- **网络权限**：不需要（完全离线）
- **存储权限**：不需要（使用应用内存储）

## 最佳实践

### 布局建议
1. **主屏幕**：放在主屏幕第一页，方便查看
2. **大小**：推荐 4x3 或更大，显示更多信息
3. **位置**：建议放在屏幕上半部分，易于触及

### 使用技巧
1. 每学期开始时重新导入课程
2. 定期检查小部件显示是否正确
3. 结合应用使用，获得完整功能
4. 如遇问题，先尝试删除重新添加

### 性能优化
- 小部件设计轻量，不影响设备性能
- 只在需要时更新，节省电量
- 使用高效的数据读取机制

## 限制说明

### Android 系统限制
- 更新频率最小30分钟（系统限制）
- 小部件尺寸由设备决定
- 某些启动器可能不支持调整大小

### 功能限制
- 仅显示今日课程（不显示其他日期）
- 不支持交互操作（除点击打开应用）
- 不显示课程颜色标记
- 长列表需要滚动查看

### 兼容性
- **最低版本**：Android 5.0 (API 21)
- **推荐版本**：Android 8.0 (API 26) 及以上
- **测试版本**：Android 11、12、13、14

## 反馈与支持

如果您在使用小部件时遇到问题：
1. 查看本文档的故障排除部分
2. 确认已按照步骤正确操作
3. 检查 Android 版本和设备兼容性
4. 提交问题到 GitHub Issues

## 未来计划

计划中的功能（可能在未来版本实现）：
- [ ] 自定义小部件主题颜色
- [ ] 选择显示特定周的课程
- [ ] 显示明天的课程
- [ ] 小部件配置选项
- [ ] 更多尺寸选择
- [ ] 下一节课倒计时

---

**注意**：小部件功能仅在 Android APK 版本中可用，Web 版本不支持。
